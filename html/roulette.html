<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>James Ockenfels – Roulette</title>
  <link rel="icon" type="image/x-icon" href="../img/FAVICON.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f7f7f7;
      --text:#e8fffb;
      --global-text:#0f2027;
      --brand:#66fcf1;
      --brand-2:#45a29e;
      --header:#1f2833;
      --card:#ffffff;
      --muted:#c5c6c7;
      --shadow:0 8px 30px rgba(0,0,0,.15);
      --soft:0 4px 12px rgba(0,0,0,.12);
      --win:#2e7d32; --lose:#c62828;
    }
    *{box-sizing:border-box}
    html,body{height:100%;font-family:Roboto,system-ui,-apple-system,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--global-text);margin:0}

    /* Header (match your site) */
    header {
        background-color: var(--header);
        color: var(--brand);
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    }
    header h1 { margin: 0; font-size: 1.8rem; font-weight: 700; }
    header nav a { color: var(--brand); margin-left: 20px; text-decoration: none; font-size: 1.1rem; transition:color .25s }
    header nav a:hover { color: var(--brand-2); }

main {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

main .content {
    background-color: white;
    padding: 40px;
    box-shadow: 0px 8px 30px rgba(0, 0, 0, 0.15);
    text-align: center;
    border-radius: 10px;
    width: 95%;
}

main h2 {
    font-size: 2.5rem;
    margin-bottom: 20px;
    color: #1f2833;
}    .table{background:var(--card);border-radius:14px;box-shadow:var(--shadow);padding:16px}

    .grid { display: grid; grid-template-columns: 1fr 380px; gap:16px; }
    @media (max-width:980px){ .grid{ grid-template-columns: 1fr; } }

    .panel{background:#fff;border-radius:12px;box-shadow:var(--soft);padding:14px}
    .panel h2, .panel h3{margin:0 0 10px;font-size:1.05rem;color:var(--header)}

    /* roulette visual */
    .wheel-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
    .wheel { width:320px; height:320px; border-radius:50%; position:relative; overflow:visible; box-shadow:0 10px 30px rgba(0,0,0,.12); background:conic-gradient(#0a0a0a 0 0); }
    .wheel-inner { position:absolute; inset:20px; border-radius:50%; background:#0f2e2b; display:grid; place-items:center; color:var(--text); font-weight:700; font-size:1.05rem }
    .pointer { width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:22px solid #fff; position:relative; top:-12px; filter:drop-shadow(0 2px 6px rgba(0,0,0,.25)); }

    .controls{display:flex;flex-direction:column;gap:8px}
    .bank{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .pill{background:#f0f0f0;padding:10px 12px;border-radius:999px}
    input[type="number"], select { padding:10px;border-radius:8px;border:1px solid #ddd }
    button{appearance:none;border:0;border-radius:10px;background:var(--header);color:var(--brand);padding:10px 14px;font-weight:600;cursor:pointer;box-shadow:0 4px 14px rgba(0,0,0,.12);transition:transform .05s ease,opacity .2s}
    button:hover{opacity:.95} button:active{transform:scale(.98)} button[disabled]{opacity:.45;cursor:not-allowed}
    .btn-ghost{background:#eef7f7;color:#0f2027}
    .btn-danger{background:#b71c1c;color:#fff}

    .log{max-height:220px;overflow:auto;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0f2027;color:#e0ffff;border-radius:12px;padding:12px}
    .log .line{margin-bottom:8px}

    footer {
        background-color: var(--header);
        color: var(--muted);
        text-align: center;
        padding: 15px;
        margin-top:12px;
    }
    footer a { color: var(--brand); margin: 0 10px; text-decoration: none; transition: color 0.3s ease; }
    footer a:hover { color: var(--brand-2); }

    /* small helpers */
    .result { font-size:1.25rem; font-weight:700; margin-top:6px; }
    .muted { color:#666; font-size:0.95rem; }
  </style>
</head>
<body>
  <header>
    <div><h1>James Ockenfels</h1></div>
    <nav>
      <a href="../index.html">Home</a>
      <a href="projects.html">Projects</a>
      <a href="goals.html">Goals</a>
      <a href="education.html">Education</a>
      <a href="about.html">About Me</a>
      <a href="contact.html">Contact</a>
      <a href="info.html">Info</a>
      <a href="blackjack.html">BlackJack</a>
            <a href="roulette.html">Roulette (NEW!)</a>
    </nav>
  </header>

  <main>
    <div class="table">
      <div class="grid">
        <section class="panel">
          <div class="wheel-wrap" aria-hidden="false">
            <div class="pointer" id="pointer"></div>
            <div class="wheel" id="wheel" title="Roulette wheel">
              <!-- wheel sectors are generated by JS as a conic-gradient overlay -->
              <div class="wheel-inner" id="wheel-center">SPIN</div>
            </div>
            <div class="result" id="result-display">Result: —</div>
            <div class="muted">Tip: Single number pays 35:1. Even-money bets (Red = Odd, Black = Even, 1-18 ,19-36) pay 1:1.</div>
          </div>
        </section>

        <aside>
          <div class="panel">
            <h3>Bank & Bet</h3>
            <div class="bank" style="align-items:center;">
              <div class="pill">Bank: $<span id="bank">0</span></div>
              <label style="margin-left:auto">
                Bet amount
                <input id="bet" type="number" min="1" step="1" value="10">
              </label>
            </div>

            <div style="margin-top:10px" class="controls">
              <label>
                Bet type
                <select id="bet-type">
                  <option value="number">Number (choose below)</option>
                  <option value="red">Red</option>
                  <option value="black">Black</option>
                  <option value="odd">Odd</option>
                  <option value="even">Even</option>
                  <option value="low">1 - 18</option>
                  <option value="high">19 - 36</option>
                </select>
              </label>
              <label id="number-label">
                Number (0-36)
                <input id="bet-number" type="number" min="0" max="36" value="7">
              </label>

              <div style="display:flex;gap:8px;margin-top:6px;">
                <button id="spin-btn">Spin</button>
                <button id="reset-btn" class="btn-danger">Reset Bank</button>
                <button id="export-btn" class="btn-ghost">Export Save</button>
                <label for="import-file" class="file-label btn-ghost" style="padding:8px;border-radius:8px;cursor:pointer;">Import Save</label>
                <input id="import-file" type="file" accept="application/json" style="display:none" />
              </div>
            </div>
          </div>

          <div class="panel" style="margin-top:12px;">
            <h3>Round Log</h3>
            <div id="log" class="log" aria-live="polite"></div>
          </div>
        </aside>
      </div>

      <footer>Have fun & play responsibly.</footer>
    </div>
  </main>

<script>
(function(){
  // storage key used by Blackjack too — this page shares bank with Blackjack
  const storageKey = 'bj-save-v2';

  // European wheel sequence (zero + standard order)
  const wheelOrder = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
  // Reds set (standard roulette)
  const redSet = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);

  // UI
  const bankEl = document.getElementById('bank');
  const betEl = document.getElementById('bet');
  const betTypeEl = document.getElementById('bet-type');
  const betNumberEl = document.getElementById('bet-number');
  const numberLabel = document.getElementById('number-label');
  const spinBtn = document.getElementById('spin-btn');
  const resultDisplay = document.getElementById('result-display');
  const logEl = document.getElementById('log');
  const wheelEl = document.getElementById('wheel');
  const wheelCenter = document.getElementById('wheel-center');
  const resetBtn = document.getElementById('reset-btn');
  const exportBtn = document.getElementById('export-btn');
  const importFile = document.getElementById('import-file');

  // create conic gradient to show colors on wheel (approximate)
  function buildWheelGradient(){
    // compute segments by wheelOrder and whether red/black/green
    const segments = [];
    const total = wheelOrder.length;
    for(let i=0;i<total;i++){
      const num = wheelOrder[i];
      const color = (num === 0) ? '#008800' : (redSet.has(num) ? '#b71c1c' : '#0d0d0d');
      const start = (i/total)*100;
      const end = ((i+1)/total)*100;
      segments.push(`${color} ${start}% ${end}%`);
    }
    wheelEl.style.background = `conic-gradient(${segments.join(',')})`;
  }
  buildWheelGradient();

  // load save (reads same structure blackjack uses). Returns object {rawSave, data}
  function loadSaveRaw(){
    try{
      const raw = localStorage.getItem(storageKey);
      if(!raw) {
        // default structure compatible with blackjack, minimal fields included
        const defaultSave = { v:2, when: new Date().toISOString(), data: { bank: 1000, bet:25, decks:6, hitSoft17:false, penetration:25, shoe:[], discard:[] } };
        return { rawSave: defaultSave, data: defaultSave.data };
      }
      const parsed = JSON.parse(raw);
      if(!parsed.data) parsed.data = { bank: 1000 };
      return { rawSave: parsed, data: parsed.data };
    }catch(e){
      console.warn('Failed load save, using defaults', e);
      const defaultSave = { v:2, when: new Date().toISOString(), data: { bank: 1000, bet:25, decks:6, hitSoft17:false, penetration:25, shoe:[], discard:[] } };
      return { rawSave: defaultSave, data: defaultSave.data };
    }
  }

  function saveRaw(rawObj){
    try{
      localStorage.setItem(storageKey, JSON.stringify(rawObj));
    }catch(e){
      console.error('Failed to save', e);
    }
  }

  // convenience: get & set bank while preserving other data
  function getBank(){
    const { data } = loadSaveRaw();
    return Number(data.bank || 0);
  }
  function setBank(value){
    const wrapper = loadSaveRaw();
    wrapper.rawSave.data = wrapper.rawSave.data || {};
    wrapper.rawSave.data.bank = Math.max(0, Math.floor(value));
    wrapper.rawSave.when = new Date().toISOString();
    saveRaw(wrapper.rawSave);
    renderBank();
  }

  function renderBank(){ bankEl.textContent = getBank(); }

  // logging
  function log(msg, cls=''){
    const d = document.createElement('div'); d.className = 'line ' + cls; d.textContent = msg;
    logEl.prepend(d);
  }

  // spin animation state
  let spinning = false;
  let currentRotation = 0;

  function indexForNumber(n){
    return wheelOrder.indexOf(Number(n));
  }

  function spinToIndex(targetIndex){
    if(spinning) return;
    spinning = true;
    spinBtn.disabled = true;
    // full rotations + land on target index
    const sectors = wheelOrder.length;
    const sectorAngle = 360 / sectors;
    // compute a random number of full spins and small offset for realism
    const fullSpins = 6 + Math.floor(Math.random()*3); // 6-8 full turns
    // target angle should place targetIndex at pointer (pointer is at top). If wheel element rotates clockwise positive, we invert.
    const targetAngle = fullSpins*360 + (targetIndex * sectorAngle) + (sectorAngle/2); // align sector middle at top
    const finalAngle = targetAngle;

    // animate via CSS transition: set transform rotate
    wheelEl.style.transition = 'transform 4s cubic-bezier(.1,.7,.1,1)';
    // rotate negative so wheel appears to spin clockwise (user expectation)
    wheelEl.style.transform = `rotate(-${finalAngle}deg)`;

    // after transition complete:
    wheelEl.addEventListener('transitionend', function handler(){
      wheelEl.style.transition = '';
      // normalize rotation value so repeated spins are relative
      currentRotation = finalAngle % 360;
      // set transform to normalized rotation (keep same visual)
      wheelEl.style.transform = `rotate(-${currentRotation}deg)`;
      wheelEl.removeEventListener('transitionend', handler);
      spinning = false;
      spinBtn.disabled = false;
    });
  }

  // determine payout - returns {win:boolean, payout:number, text:string}
  function evaluateBet(resultNumber, betType, betAmount, chosenNumber){
    let win = false, payout = 0, text='';
    if(betType === 'number'){
      if(Number(chosenNumber) === Number(resultNumber)){
        win = true;
        payout = betAmount * 36; // returns bet + 35:1
        text = `Hit number ${resultNumber}! Paid 35:1.`;
      } else {
        win = false; payout = 0; text = `No hit: ${resultNumber}.`;
      }
    } else if(betType === 'red' || betType === 'black'){
      if(resultNumber === 0){
        win = false; payout = 0; text = `0 — house wins on even-money bets.`;
      } else {
        const isRed = redSet.has(resultNumber);
        if((betType === 'red' && isRed) || (betType === 'black' && !isRed)){
          win = true; payout = betAmount * 2; text = `${resultNumber} ${(isRed?'red':'black')} — paid 1:1.`;
        } else { win = false; payout = 0; text = `${resultNumber} ${(isRed?'red':'black')} — you lost.`; }
      }
    } else if(betType === 'odd' || betType === 'even'){
      if(resultNumber === 0){ win = false; payout = 0; text = `0 — house wins on even-money bets.`; }
      else {
        const isEven = (resultNumber % 2 === 0);
        if((betType === 'even' && isEven) || (betType === 'odd' && !isEven)){
          win = true; payout = betAmount * 2; text = `${resultNumber} is ${isEven?'even':'odd'} — paid 1:1.`;
        } else { win = false; payout = 0; text = `${resultNumber} is ${isEven?'even':'odd'} — you lost.`; }
      }
    } else if(betType === 'low' || betType === 'high'){
      if(resultNumber === 0){ win = false; payout = 0; text = `0 — house wins on this bet.`; }
      else {
        const isLow = (resultNumber >=1 && resultNumber <=18);
        if((betType === 'low' && isLow) || (betType === 'high' && !isLow)){
          win = true; payout = betAmount * 2; text = `${resultNumber} — paid 1:1.`;
        } else { win = false; payout = 0; text = `${resultNumber} — you lost.`; }
      }
    } else {
      win = false; payout = 0; text = `Invalid bet.`;
    }
    return { win, payout, text };
  }

  // handle spin flow
  async function handleSpin(){
    if(spinning) return;
    const betAmount = Math.max(1, Math.floor(Number(betEl.value) || 0));
    const bank = getBank();
    if(betAmount > bank){
      alert('Bet exceeds bank.');
      return;
    }
    const betType = betTypeEl.value;
    const chosenNumber = Number(betNumberEl.value);

    if(betType === 'number'){
      if(Number.isNaN(chosenNumber) || chosenNumber < 0 || chosenNumber > 36){
        alert('Pick a number 0-36 for Number bet.');
        return;
      }
    }

    // pay bet (subtract now)
    setBank(bank - betAmount);

    // pick random result index
    const targetIndex = Math.floor(Math.random() * wheelOrder.length);
    const resultNumber = wheelOrder[targetIndex];

    // animate spin (land on target index)
    spinToIndex(targetIndex);

    // wait a bit for wheel to finish (approx 4200ms)
    await new Promise(res => setTimeout(res, 4300));

    // evaluate
    const evalRes = evaluateBet(resultNumber, betType, betAmount, chosenNumber);
    // add payout (if any)
    if(evalRes.payout && evalRes.payout > 0) {
      const newBank = getBank() + evalRes.payout;
      setBank(newBank);
    }

    // update center text & result display
    const color = (resultNumber===0) ? 'green' : (redSet.has(resultNumber) ? 'red' : 'black');
    wheelCenter.textContent = resultNumber;
    wheelCenter.style.color = (color === 'green' ? '#cfead1' : '#e8fffb');

    resultDisplay.textContent = `Result: ${resultNumber} (${color.toUpperCase()}) — ${evalRes.text}`;
    log(`${evalRes.win ? '✅ WIN' : '❌ LOSE'} | Bet ${betAmount} on ${betType}${betType==='number'?' '+chosenNumber:''} → ${resultNumber}. Bank: $${getBank()}.`);
  }

  // UI wiring
  betTypeEl.addEventListener('change', ()=> {
    if(betTypeEl.value === 'number') numberLabel.style.display = 'block';
    else numberLabel.style.display = 'none';
  });
  // initial state for number input
  betTypeEl.dispatchEvent(new Event('change'));

  spinBtn.addEventListener('click', handleSpin);

  // reset bank (confirm)
  resetBtn.addEventListener('click', ()=> {
    if(confirm('Reset bank to $1000 and preserve other saved settings?')){
      const wrapper = loadSaveRaw();
      wrapper.rawSave.data = wrapper.rawSave.data || {};
      wrapper.rawSave.data.bank = 1000;
      wrapper.rawSave.when = new Date().toISOString();
      saveRaw(wrapper.rawSave);
      renderBank();
      log('<b>Bank reset to $1000</b>');
    }
  });

  // export & import (same behaviour as blackjack)
  exportBtn.addEventListener('click', ()=>{
    const payload = localStorage.getItem(storageKey) || JSON.stringify({ v:2, when:new Date().toISOString(), data:{ bank:getBank() } });
    const blob = new Blob([payload], { type:'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'casino-save.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  importFile.addEventListener('change', async (ev)=> {
    const file = ev.target.files[0]; if(!file) return;
    try{
      const text = await file.text();
      const obj = JSON.parse(text);
      if(!obj || !obj.data) throw new Error('Invalid save file');
      // merge: keep obj (user import) but ensure structure
      obj.data = obj.data || {};
      if(typeof obj.data.bank === 'undefined') obj.data.bank = getBank();
      obj.when = new Date().toISOString();
      saveRaw(obj);
      renderBank();
      log('<b>Imported save file</b>');
    }catch(e){
      alert('Could not import save: ' + e.message);
    } finally {
      ev.target.value = '';
    }
  });

  // initial render
  renderBank();
  log('Roulette ready.');
})();
</script>
    <footer>
        <p>Connect with me:</p>
        <a href="https://github.com">GitHub</a>
        <a href="https://youtube.com">YouTube</a>
        <a href="https://tryhackme.com">TryHackMe</a>
    </footer>
</body>
</html>
